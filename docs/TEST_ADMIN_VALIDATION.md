# Ручная проверка валидаций админки

Проверка slug, обязательных полей и сообщений об ошибках.

## Подготовка

1. Запустите сервер: `php -S 127.0.0.1:8010 -t public public/router.php`
2. Откройте админку: http://127.0.0.1:8010/admin/login (логин/пароль из `app/config.php`)
3. Убедитесь, что в БД есть хотя бы одна категория (например, AISI 304)

---

## Товары (product_edit)

### 1) Создать товар без slug → slug генерируется, сохранение успешно

- Админка → Товары → Создать товар
- Категория: выберите любую
- Название: `Лента AISI 304 0,5 мм BA`
- Slug: **оставьте пустым**
- Заполните толщину, цену и т.д.
- Сохранить  
**Ожидание:** товар сохраняется, slug автоматически становится вида `lenta-aisi-304-05-mm-ba` (или с суффиксом `-2`, если такой уже есть).

### 2) Создать товар с существующим slug → ошибка «slug занят»

- Создать товар
- Slug: введите slug уже существующего товара (например, из списка товаров)
- Остальные поля заполните
- Сохранить  
**Ожидание:** сообщение об ошибке у поля Slug: «Slug уже занят. Измените или оставьте пустым для автогенерации.»

### 3) Создать товар с пустым названием → ошибка required

- Создать товар
- Название: **оставьте пустым**
- Сохранить  
**Ожидание:** ошибка у поля «Название»: «Название обязательно». Форма не отправляется (или показывается ошибка).

### 4) Толщина = 0 или -1 → ошибка валидации

- Создать/редактировать товар
- Толщина (мм): `0` или `-1`
- Сохранить  
**Ожидание:** ошибка у поля «Толщина»: «Толщина должна быть больше 0».

### 5) Поверхность / состояние — недопустимое значение

- Через инструменты разработчика измените в форме, например, `<select name="surface">` — добавьте опцию с value="XXX" и выберите её (или отправьте POST с surface=XXX)
- Сохранить  
**Ожидание:** ошибка у поля: «Недопустимое значение поверхности» или «Недопустимое значение состояния».

### 6) Редактировать товар, изменить название → slug не меняется

- Откройте существующий товар на редактирование
- Запомните текущий slug
- Измените только название (например, добавьте « (мягкая)»)
- Сохранить  
**Ожидание:** slug остаётся прежним, меняется только название.

### 7) Два товара с одинаковым названием без slug → у второго slug с суффиксом -2

- Создайте товар: название `Тестовая лента`, slug пустой → сохранить (slug станет `testovaya-lenta` или подобный)
- Создайте ещё один товар: название `Тестовая лента`, slug пустой → сохранить  
**Ожидание:** второй товар сохраняется со slug `testovaya-lenta-2` (или следующим свободным суффиксом).

### 8) Цена отрицательная → ошибка

- Цена за кг: `-100`
- Сохранить  
**Ожидание:** ошибка у поля «Цена за кг»: «Цена не может быть отрицательной».

---

## Категории (category_edit)

### 9) Создать категорию без slug → slug из названия

- Админка → Категории → Создать категорию
- Название: `AISI 405`
- Slug: **оставьте пустым**
- Сохранить  
**Ожидание:** slug автоматически, например, `aisi-405`. Если такой slug уже есть — будет `aisi-405-2` и т.д.

### 10) Slug категории занят → ошибка

- Создать категорию
- Slug: введите slug существующей категории (например, `aisi-304`)
- Сохранить  
**Ожидание:** сообщение «Slug уже занят. Измените или оставьте пустым для автогенерации.»

---

## Стабильность (антикраш)

- Создание товара без обязательных полей (категория, название) не должно приводить к белому экрану — только к списку/полю ошибок.
- Пустой slug при заполненном названии не ломает сохранение — slug генерируется.
- Дубликат slug не даёт 500 — только ошибку у поля slug.
- При ошибке БД (например, UNIQUE) пользователь видит понятное сообщение, а не «500 Internal Server Error».

---

## Итог

После прохождения сценариев:

- В БД: slug UNIQUE NOT NULL (уже в `storage/init.sql`)
- На сервере: нормализация slug, `ensure_unique_slug`, проверка полей (толщина, цена, condition, surface)
- В админке: ошибки у полей (inline), одна кнопка «Сохранить»
- Невозможно сохранить товар с пустым названием, отрицательной ценой/толщиной и дубликатом slug
